{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/useResizeDetector.ts"],"sourcesContent":["import debounce from 'lodash/debounce';\nimport throttle from 'lodash/throttle';\nimport type { DebouncedFunc } from 'lodash';\n\nimport { Props } from './types';\n\nexport type PatchedResizeObserverCallback = DebouncedFunc<ResizeObserverCallback> | ResizeObserverCallback;\n\nexport const patchResizeCallback = (\n  resizeCallback: ResizeObserverCallback,\n  refreshMode: Props['refreshMode'],\n  refreshRate: Props['refreshRate'],\n  refreshOptions: Props['refreshOptions']\n): PatchedResizeObserverCallback => {\n  switch (refreshMode) {\n    case 'debounce':\n      return debounce(resizeCallback, refreshRate, refreshOptions);\n    case 'throttle':\n      return throttle(resizeCallback, refreshRate, refreshOptions);\n    default:\n      return resizeCallback;\n  }\n};\n","import { useEffect, useState, useRef, useCallback, useMemo } from 'react';\nimport type { DebouncedFunc } from 'lodash';\n\nimport { patchResizeCallback } from './utils';\n\nimport type {\n  OnRefChangeType,\n  ReactResizeDetectorDimensions,\n  UseResizeDetectorReturn,\n  useResizeDetectorProps\n} from './types';\n\nfunction useResizeDetector<T extends HTMLElement = any>({\n  skipOnMount = false,\n  refreshMode,\n  refreshRate = 1000,\n  refreshOptions,\n  handleWidth = true,\n  handleHeight = true,\n  targetRef,\n  observerOptions,\n  onResize\n}: useResizeDetectorProps<T> = {}): UseResizeDetectorReturn<T> {\n  const skipResize = useRef<boolean>(skipOnMount);\n\n  const [size, setSize] = useState<ReactResizeDetectorDimensions>({\n    width: undefined,\n    height: undefined\n  });\n\n  // we are going to use this ref to store the last element that was passed to the hook\n  const [refElement, setRefElement] = useState<T | null>(targetRef?.current || null);\n\n  // if targetRef is passed, we need to update the refElement\n  // we have to use setTimeout because ref get assigned after the hook is called\n  // in the future releases we are going to remove targetRef and force users to use ref returned by the hook\n  if (targetRef) {\n    setTimeout(() => {\n      if (targetRef.current !== refElement) {\n        setRefElement(targetRef.current);\n      }\n    }, 0);\n  }\n\n  // this is a memo that will be called every time the ref is changed\n  // This proxy will properly call setState either when the ref is called as a function or when `.current` is set\n  // we call setState inside to trigger rerender\n\n  const refProxy: OnRefChangeType<T> = useMemo(\n    () =>\n      new Proxy(\n        node => {\n          if (node !== refElement) {\n            setRefElement(node);\n          }\n        },\n        {\n          get(target, prop) {\n            if (prop === 'current') {\n              return refElement;\n            }\n            return target[prop];\n          },\n          set(target, prop, value) {\n            if (prop === 'current') {\n              setRefElement(value);\n            } else {\n              target[prop] = value;\n            }\n            return true;\n          }\n        }\n      ),\n    [refElement]\n  );\n\n  const shouldSetSize = useCallback(\n    (prevSize: ReactResizeDetectorDimensions, nextSize: ReactResizeDetectorDimensions) => {\n      if (prevSize.width === nextSize.width && prevSize.height === nextSize.height) {\n        // skip if dimensions haven't changed\n        return false;\n      }\n\n      if (\n        (prevSize.width === nextSize.width && !handleHeight) ||\n        (prevSize.height === nextSize.height && !handleWidth)\n      ) {\n        // process `handleHeight/handleWidth` props\n        return false;\n      }\n\n      return true;\n    },\n    [handleWidth, handleHeight]\n  );\n\n  const resizeCallback: ResizeObserverCallback = useCallback(\n    (entries: ResizeObserverEntry[]) => {\n      if (!handleWidth && !handleHeight) return;\n\n      if (skipResize.current) {\n        skipResize.current = false;\n        return;\n      }\n\n      entries.forEach(entry => {\n        const { width, height } = entry?.contentRect || {};\n        setSize(prevSize => {\n          if (!shouldSetSize(prevSize, { width, height })) return prevSize;\n          return { width, height };\n        });\n      });\n    },\n    [handleWidth, handleHeight, skipResize, shouldSetSize]\n  );\n\n  const resizeHandler = useCallback(patchResizeCallback(resizeCallback, refreshMode, refreshRate, refreshOptions), [\n    resizeCallback,\n    refreshMode,\n    refreshRate,\n    refreshOptions\n  ]);\n\n  // on refElement change\n  useEffect(() => {\n    let resizeObserver: ResizeObserver | undefined;\n    if (refElement) {\n      const w = refElement.ownerDocument?.defaultView ?? window;\n      resizeObserver = new w.ResizeObserver(resizeHandler);\n      resizeObserver.observe(refElement, observerOptions);\n    } else {\n      if (size.width || size.height) {\n        setSize({ width: undefined, height: undefined });\n      }\n    }\n\n    return () => {\n      resizeObserver?.disconnect?.();\n      (resizeHandler as DebouncedFunc<ResizeObserverCallback>).cancel?.();\n    };\n  }, [resizeHandler, refElement]);\n\n  useEffect(() => {\n    onResize?.(size.width, size.height);\n  }, [size]);\n\n  return { ref: refProxy, ...size };\n}\n\nexport default useResizeDetector;\n"],"names":["useRef","useState","useMemo","useCallback","useEffect"],"mappings":"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"}